CREATE TABLE donors (
    id INT AUTO_INCREMENT PRIMARY KEY,
    fullname VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    blood_type VARCHAR(10),
    location VARCHAR(100),
    is_available TINYINT(1) DEFAULT 1,
    verification_code VARCHAR(10),
    is_verified TINYINT(1) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE hospitals (
  id INT AUTO_INCREMENT PRIMARY KEY,
  hospital_name VARCHAR(150) NOT NULL,
  contact_person VARCHAR(100) NOT NULL,
  email VARCHAR(150) NOT NULL UNIQUE,
  phone VARCHAR(20) NOT NULL,
  city VARCHAR(100) NOT NULL,
  address VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  verification_code VARCHAR(10),
  is_verified TINYINT(1) DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE donations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    donor_id INT NOT NULL,
    hospital_id INT DEFAULT NULL,
    hospital_name VARCHAR(150),
    blood_type VARCHAR(10) NOT NULL,
    donation_date DATE DEFAULT CURRENT_DATE,
    status ENUM('Pending', 'Completed', 'Cancelled') DEFAULT 'Pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (donor_id) REFERENCES donors(id) ON DELETE CASCADE,
    FOREIGN KEY (hospital_id) REFERENCES hospitals(id) ON DELETE SET NULL
);


CREATE TABLE blood_requests (
    id INT AUTO_INCREMENT PRIMARY KEY,
    hospital_id INT NOT NULL,
    blood_type VARCHAR(10) NOT NULL,
    units_needed INT NOT NULL,
    urgency ENUM('Low', 'Medium', 'High') DEFAULT 'Medium',
    status ENUM('Pending', 'Fulfilled', 'Cancelled') DEFAULT 'Pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (hospital_id) REFERENCES hospitals(id) ON DELETE CASCADE
);

ALTER TABLE blood_requests
    ADD COLUMN IF NOT EXISTS patient_name VARCHAR(150) NULL,
    ADD COLUMN IF NOT EXISTS location VARCHAR(150) NULL,
    ADD COLUMN IF NOT EXISTS contact VARCHAR(50) NULL,
    ADD COLUMN IF NOT EXISTS notes TEXT NULL,
    ADD COLUMN IF NOT EXISTS hospital_name VARCHAR(150) NULL;

ALTER TABLE donations
    ADD COLUMN IF NOT EXISTS units INT DEFAULT 1;

-- Optionally add recipient_id if you want to track recipient reference
ALTER TABLE donations
    ADD COLUMN IF NOT EXISTS recipient_id INT NULL;


ALTER TABLE donors ADD COLUMN IF NOT EXISTS date_of_birth DATE NULL;
ALTER TABLE donors ADD COLUMN IF NOT EXISTS country VARCHAR(100) NULL;
ALTER TABLE donors ADD COLUMN IF NOT EXISTS address VARCHAR(255) NULL;
ALTER TABLE donors ADD COLUMN IF NOT EXISTS emergency_contact_name VARCHAR(100) NULL;
ALTER TABLE donors ADD COLUMN IF NOT EXISTS emergency_contact_phone VARCHAR(30) NULL;
ALTER TABLE donors ADD COLUMN IF NOT EXISTS is_available TINYINT(1) NOT NULL DEFAULT 1;

