<?php
session_start();
require_once 'ClassAutoLoad.php';

// Security check ‚Äî only allow logged-in donors
if (!isset($_SESSION['donor_id'])) {
    header("Location: signin.php");
    exit();
}

// Fetch donor details
$donor_id = $_SESSION['donor_id'];

$stmt = $conn->prepare("SELECT fullname, email, phone, blood_type, location, created_at FROM donors WHERE id = :id");
$stmt->execute([':id' => $donor_id]);
$donor = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$donor) {
    $_SESSION['banner'] = ['type' => 'error', 'message' => 'Donor not found.'];
    header("Location: signin.php");
    exit();
}

// Page title
$conf['page_title'] = 'BloodBank | Donor Dashboard';

// Render layout
$Objlayout->header($conf);
?>

<link rel="stylesheet" href="CSS/style.css">
<link rel="stylesheet" href="CSS/forms.css">

<nav class="dashboard-navbar">
    <div class="dashboard-logo">
        ‚ù§Ô∏è <?php echo $conf['site_name']; ?> Dashboard
    </div>
    <ul class="dashboard-links">
        <li><a href="donor_dashboard.php" class="active">Home</a></li>
        <li><a href="blood_requests.php">Requests</a></li>
        <li><a href="donation_history.php">Donations</a></li>
        <li><a href="profile.php">Profile</a></li>
        <li><a href="logout.php" class="logout-btn">Logout</a></li>
    </ul>
</nav>

<section class="dashboard">
    <div class="dashboard-container">
        <h2>Welcome, <?php echo htmlspecialchars($donor['fullname']); ?> üëã</h2>

        <div class="dashboard-card">
            <h3>Your Information</h3>
            <ul>
                <li><strong>Email:</strong> <?php echo htmlspecialchars($donor['email']); ?></li>
                <li><strong>Phone:</strong> <?php echo htmlspecialchars($donor['phone']); ?></li>
                <li><strong>Blood Type:</strong> <?php echo htmlspecialchars($donor['blood_type']); ?></li>
                <li><strong>Location:</strong> <?php echo htmlspecialchars($donor['location']); ?></li>
                <li><strong>Joined:</strong> <?php echo date("F j, Y", strtotime($donor['created_at'])); ?></li>
            </ul>
        </div>

        <div class="dashboard-card">
            <h3>Donation History</h3>
            <p>No donations yet.</p>
            <!-- Later: Fetch from a donations table -->
        </div>

        <div class="dashboard-card">
            <h3>Upcoming Donation Events</h3>
            <p>Stay tuned for blood drive announcements!</p>
        </div>
    </div>
</section>

<?php
$Objlayout->footer($conf);
?>
